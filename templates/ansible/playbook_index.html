{% extends "../base_public.html" %}

{% block content %}
<div class="container" style="width:80%;padding-left: 180px;">
    <h3 style="text-align: center; color:#44b073;">æ‰§è¡ŒAnsible Playbook</h3>
<form method="GET" action="/ansible/opt_task/">{% csrf_token %}
    <div class="row">
        <div class="col-sm-6">
            <div class="form-group">
                <label for="exampleInputEmail1">ç»„åˆ—è¡¨</label>
                <select name="groupName" class="form-control">
                    <option value="None">æ— éœ€è¯¥å‚æ•°</option>
                    {% for g in groups %}
                        <option value={{ g.groupName }}>
                            {{ g.nickName|default:g.groupName }}&nbsp;<------>&nbsp;{{ g.groupName }}
                        </option>
                    {% endfor %}
                </select>
              </div>
        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label for="exampleInputPassword1">ä»»åŠ¡ç»„</label>
                <select class="form-control" name="playbook">
                    <option value="None">é€‰æ‹©ä¸€ä¸ªä»»åŠ¡ç»„</option>
                    {% for f in functions %}
                        <option value="{{ f.playbook }}">{{ f.nickName|default:f.playbook }}</option>
                    {% endfor %}
                </select>
              </div>
        </div>

    </div>
  <div class="form-group">
    <label for="exampleInputPassword1">è¾“å…¥æ‰€éœ€è¦çš„å‚æ•°</label>
    <textarea type="text" class="form-control" name="vars" rows=9></textarea>
  </div>
  <button type="submit" id="push" class="btn btn-default">æäº¤</button><input type="checkbox" style="margin-left: 50px;"> ğŸ”&nbspæäº¤é”
</form>
    <div calss="row">
        <hr style="height:1px;border:none;border-top:1px solid #555555;">
        <div class="panel panel-default" id="mydata" hidden>
                <div class="panel-body"></div>
              </div>
            <button id="check_group"class="btn btn-default">æŸ¥çœ‹é€‰ä¸­ç»„</button>
            <button id="check_playbook" class="btn btn-default">æŸ¥çœ‹é€‰ä¸­PlayBook</button>
            <button id="close_win" class="btn btn-info">å…³é—­ä¿¡æ¯çª—å£</button>
    </div>
</div>

</div>
<script type="text/javascript">
    $('#check_group').click(function(){
        v = $("select[name='groupName'] option:selected")[0].value
        if(v==="None"){
            alert("æœªé€‰æ‹©ç»„")
        }else{
            $.ajax({
                url: "/ansible/get_groups/"+v,
                success: function(msg){
                    $('#mydata')[0].hidden = false
                    s = "ç»„å: " + msg.groupName + '<br>æè¿°: ' + msg.nickName + '<br>ä¸»æœºåˆ—è¡¨:'
                    $.each(msg.hosts, function(a,b){
                        s += b.hostName + 'ã€'
                    })
                    $('#mydata')[0].children[0].innerHTML = s
                    console.log(msg)
                }
            })
        }

    })
    $('#check_playbook').click(function(){
        console.log("AAA")
    })
    $('#close_win').click(function(){
        $('#mydata')[0].hidden = true
    })
    $('#push').click(function(){
        if($("select[name='playbook'] option:selected")[0].value=="None"){
            alert('å¿…é¡»é€‰æ‹©ä¸€ä¸ªæ“ä½œç»„')
            return false    // é˜»æ­¢æäº¤
        }else if($('input[type="checkbox"]')[0].checked===false){
            alert('è¯·æ‰“å¼€é” ğŸ”')
            return false
        }else{
            return true
        }   

    })

</script>

{% endblock %}
